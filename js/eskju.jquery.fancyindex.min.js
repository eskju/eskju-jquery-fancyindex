/*
 * jQuery fancyIndex plugin
 *
 * Copyright (c) 2014 Christian Witte
 * licensed under MIT license.
 *
 * https://github.com/eskju/eskju-jquery-fancyindex
 *
 * Version: 1.0
 * 
 * Licensed under MIT license.
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software 
 * and associated documentation files (the "Software"), to deal in the Software without restriction, 
 * including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, 
 * and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, 
 * subject to the following conditions:
 * The above copyright notice and this permission notice shall be included in all copies or substantial 
 * portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT 
 * LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
 * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, 
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE 
 * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

$.fn.FancyIndex=function(a){new FancyIndex(this,a)};FancyIndex=function(a,b){this.init(a,b)};$.extend(FancyIndex.prototype,{init:function(a,b){this.selector=$(a);this.items=[];this.disabled=false;this.lastActivity=0;this.options=$.extend({hideWhenInactive:true,focusInitally:true,focusOnResize:true,focusOnScroll:true,focusOnHover:true,focusTimeout:1000,firstOnly:false,forceLastActive:true,scrollToDuration:1000,scrollOnClick:true,maxPrioritizedItems:3},b);this.loadHierarchy();this.bindSelf();this.bindScroll();this.bindResize();this.bindHover();this.updateItems();if(this.options.hideWhenInactive){if(this.options.focusInitally){this.setActive()}else{this.hide()}}},setActive:function(){var a=this;$("#esKju-fancyIndex").removeClass("inactive");$("#esKju-fancyIndex").animate({minHeight:0},parseInt(this.options.focusTimeout),function(){a.hide()})},hide:function(){if(this.options.hideWhenInactive){$("#esKju-fancyIndex").addClass("inactive")}},bindSelf:function(){var a=this;$("body").bind("refreshFancyIndex",function(c,b){a.options=b})},bindScroll:function(){var a=this;$(window).scroll(function(){a.updateItems();if(a.options.focusOnScroll){a.setActive()}})},bindResize:function(){var a=this;$(window).resize(function(){a.updateItems();if(a.options.focusOnResize){a.setActive()}})},bindHover:function(){var a=this;$("#esKju-fancyIndex").hover(function(){if(a.options.focusOnHover){a.setActive()}})},updateItems:function(){var e=this;var d=$(window).scrollTop();var f=$(window).height();var b=false;var c=parseInt(this.options.maxPrioritizedItems);var a=false;$.each(e.items,function(g,h){$(h.obj).removeClass("active");$(h.obj).removeClass("prioritized");for(i=1;i<=parseInt(e.options.maxPrioritizedItems);i++){$(h.obj).removeClass("priority-"+i)}if(d>parseInt(h.offset.top)+50){a=$(h.obj)}if((d<=parseInt(h.offset.top)+50&&d+f>=parseInt(h.offset.top)&&(!e.options.firstOnly||!b))&&(parseInt(e.options.maxPrioritizedItems)==0||c>0)){$(h.obj).addClass("active");$(h.obj).addClass("prioritized");$(h.obj).addClass("priority-"+c);b=true;c--}});if(e.options.forceLastActive&&$("#esKju-fancyIndex .active").length==0){$(a).addClass("active");$(a).addClass("prioritized");$(a).addClass("priority-"+e.options.maxPrioritizedItems)}},loadHierarchy:function(){var a=this;this.items=[];esKjuFancyIndex=$("<ul>").attr("id","esKju-fancyIndex");$("body").append(esKjuFancyIndex);$(this.selector.find("h1,h2,h3,h4,h5,h6,h7")).each(function(c,f){var b=$(f).prop("tagName").toLowerCase();var e=$(f).html();var g=$(f).offset();var d=$("<li>").addClass(b).html("<div>"+e+"</div>");esKjuFancyIndex.append(d);a.items.push({offset:g,obj:d});if(a.options.scrollOnClick){$(d).find("div").click(function(){g=$(f).offset();$("html, body").animate({scrollTop:g.top},parseInt(a.options.scrollToDuration))})}})}});